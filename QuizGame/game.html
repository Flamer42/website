<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }

        .container-opt {
            text-align: center;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            margin: 10px;
        }
        .container-gb {
            display: none;
            text-align: center;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            margin: 10px;
        }

        .container-btns {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        input[type="text"] {
            padding: 10px;
            font-size: 16px;
            width: calc(100% - 22px);
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            max-width: 200px;
            margin: 10px auto;
        }

        button:hover {
            background-color: #0056b3;
        }

        #gameBoard button {
            margin: 5px 0;
        }

        @media (max-width: 600px) {
            .container-opt, .container-gb {
                padding: 15px;
            }

            button {
                padding: 8px 16px;
                font-size: 14px;
            }

            input[type="text"] {
                padding: 8px;
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <div class="container-opt" id="container-opt">
        <br>
        <div>
            <input type="text" id="opt-field" name="message">
        </div>
        <br><br>
        <div>
            <div id="opt-list"></div>
        </div>
        <br>
        <button id="start" onclick=start()>Start</button>
        <button id="back" onclick="back()">Back</button>
        <br>
    </div>
    <div class="container-gb" id="container-gb">
        <div id="gameBoard">

        </div>
    </div>

    <script>

        let options = [];
        let currentQuiz;

        showOptions();

        var optField = document.getElementById("opt-field");
        optField.addEventListener("keydown", function (event) {
            if (event.keyCode == 13) {
                options.push(optField.value);
                showOptions()
            }
        });


        function removeOption(index) {
            options.splice(index, 1);
            showOptions();
        }

        function showOptions() {
            let optlist = document.getElementById('opt-list');
            optlist.innerHTML = '';
            if (options.length === 0) {
                optlist.innerHTML = ("Nessun opzione presente.");
            } else {
                for (let i = 0; i < options.length; i++) {
                    let option = options[i];
                    let optElement = document.createElement('div');
                    optElement.innerHTML =
                        `${option}
                        <button onclick=removeOption(${i})>X</button>
                        <br>`;
                    optlist.appendChild(optElement);
                }
            }
        }

        async function start() {
            let containerOpt = document.getElementById("container-opt");
            let containerGB = document.getElementById("container-gb");
            containerOpt.style.display = 'none';
            containerGB.style.display = 'block';


            // qua impostiamo invisibile il div container-opt e rendiamo visible il div container-gb
            //fetchiamo il primo quiz chiamando il metodo getQuiz() 

            getQuiz()
        }

        function buildPrompt() {
            return options.join(' or ');
        }

        async function getQuiz() {

            let buildingPrompt = buildPrompt();

            let prompt = `Write just one quiz about ${buildingPrompt} with only 1 correct option and use this format: Question?;option 1;option 2;option 3;option 4;position of the correct option as a number`
            console.log(prompt)

            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: 'Bearer gAAAAABmYcL0prqwHw6VT3TlQmHWEoKzMh-FWUZatEfhmUKAeFdwI7UId4nBRVNCk_1aP-8NgjK4Y2F78dolTRZBEeydTVm2C3aQv2B19KWMgll_4nE0NB-hZaZGBuBdyOcTT7d69WIL'
                },
                body: `{"max_tokens":2048,"mode":"python","model":"icortex-1","n":1,"temperature":null,"text":"${prompt}"}`
            };

            await fetch('https://api.textcortex.com/v1/codes', options)
                .then(response => {
                    console.log(response)
                    return response.json()
                })
                .then(response => {
                    console.log(response)
                    console.log(response.data.outputs[0].text)
                    currentQuiz = response.data.outputs[0].text;
                })
                .catch(err => console.error(err));

            currentQuiz = currentQuiz.toString()
            cQ = currentQuiz.split(';');

            if (cQ.length !== 6) {
                getQuiz();
                return;
            }

            let gb = document.getElementById("gameBoard");
            gb.style.pointerEvents = 'auto';
            gb.innerHTML = '';
            let createGameBoard = document.createElement('div');
            createGameBoard.innerHTML = `
                <h3>${cQ[0]}</h3>
                <button id="opt1" onclick="checkWin(1)">${cQ[1]}</button>
                <button id="opt2" onclick="checkWin(2)">${cQ[2]}</button>
                <button id="opt3" onclick="checkWin(3)">${cQ[3]}</button>
                <button id="opt4" onclick="checkWin(4)">${cQ[4]}</button>
                <br><br>
                <div>
                    <button id="nextQuiz" onclick="getQuiz()">Next quiz</button>
                    <button id="backBtn" onclick="back()">Back</button>
                </div>
            `
            gb.appendChild(createGameBoard)
        }

        function checkWin(index) {
            if (cQ[5].length > 1) {
                getQuiz();
                return;
            }
            if (parseInt(cQ[5]) === index) {
                let cAnswer = document.getElementById(`opt${index}`)
                cAnswer.style.backgroundColor = "Green";
                console.log("sei forte")
            } else {
                let cAnswer = document.getElementById(`opt${index}`)
                cAnswer.style.backgroundColor = "Red";
                console.log("sei scarso")
            }
            let gb = document.getElementById('gameBoard')
            gb.style.pointerEvents = 'none';
            let nextBtn = document.getElementById('nextQuiz')
            nextBtn.style.pointerEvents = 'auto'
            let backBtn = document.getElementById('backBtn')
            backBtn.style.pointerEvents = 'auto'

        }

        function back() {
            var loc = window.location.pathname;
            newloc = loc.substring(0, loc.lastIndexOf('/'))
            let dir = newloc.substring(0, newloc.lastIndexOf('/')) + "/hub.html";
            window.location.replace(dir);
        }
    </script>
</body>

</html>
